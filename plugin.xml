<?xml version="1.0" encoding="UTF-8"?>
<plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"
        xmlns:android="http://schemas.android.com/apk/res/android"
        id="cordova-plugin-baidu-push-2024"
        version="1.0.16">

    <name>BaiduPush</name>
    <description>Cordova plugin for Baidu Push Service</description>
    <license>MIT</license>
    <keywords>cordova, baidu, push notifications</keywords>

    <js-module src="www/baiduPush.js" name="baiduPush">
        <clobbers target="baiduPush" />
    </js-module>

    <!-- android -->
    <platform name="android">
        <config-file target="res/xml/config.xml" parent="/*">
        <feature name="BaiduPush">
            <param name="android-package" value="com.cordova.plugins.push.baidu.BaiduPush" />
        </feature>
        </config-file>
        
        <!-- Uses Permissions -->
        <config-file target="AndroidManifest.xml" parent="/*">
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
            <uses-permission android:name="android.permission.VIBRATE" />
            <uses-permission android:name="baidu.push.permission.WRITE_PUSHINFOPROVIDER.com.cordova.plugins.push.baidu" />
            <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
            <uses-permission android:name="com.vivo.abe.permission.launcher.notification.num" />
            <uses-permission android:name="com.vivo.notification.permission.BADGE_ICON" />
            <uses-permission android:name="com.huawei.android.launcher.permission.CHANGE_BADGE" />
            <uses-permission android:name="com.cordova.plugins.push.baidu.permission.MIPUSH_RECEIVE" />
        </config-file>

        <!-- Declare permission -->
        <config-file target="AndroidManifest.xml" parent="/*">
            <permission
                android:name="baidu.push.permission.WRITE_PUSHINFOPROVIDER.com.cordova.plugins.push.baidu"
                android:protectionLevel="signature" />

            <permission
                android:name="com.cordova.plugins.push.baidu.permission.MIPUSH_RECEIVE"
                android:protectionLevel="signature" />
        </config-file>

        <!-- Push SDK Components -->
        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <activity
                android:name="com.baidu.android.pushservice.PushNotifyDispatchActivity"
                android:launchMode="singleTask"
                android:theme="@android:style/Theme.NoDisplay" />
            <service
                android:name="com.baidu.android.pushservice.PushService"
                android:exported="false"
                android:process=":bdservice_v1" >
                <intent-filter>
                    <action android:name="com.baidu.android.pushservice.action.PUSH_SERVICE" />
                </intent-filter>
            </service>
            <service
                android:name="com.baidu.android.pushservice.CommandService"
                android:exported="false" />

            <provider
                android:name="com.baidu.android.pushservice.PushInfoProvider"
                android:authorities="com.cordova.plugins.push.baidu.bdpush"
                android:exported="true"
                android:process=":bdservice_v1"
                android:protectionLevel="signature"
                android:writePermission="baidu.push.permission.WRITE_PUSHINFOPROVIDER.com.cordova.plugins.push.baidu" />
                
            <receiver
                android:name="com.baidu.android.pushservice.RegistrationReceiver"
                android:process=":bdservice_v1">
                <intent-filter>
                    <action android:name="com.baidu.android.pushservice.action.METHOD" />
                </intent-filter>
            </receiver>


            <receiver android:name="com.cordova.plugins.push.baidu.BaiduPushReceiver">
                <intent-filter>
                    <action android:name="com.baidu.android.pushservice.action.MESSAGE" />
                    <action android:name="com.baidu.android.pushservice.action.RECEIVE" />
                    <action android:name="com.baidu.android.pushservice.action.notification.CLICK" />

                    <!-- 使用华为代理功能必须声明,用于接收华为的透传 -->
                    <action android:name="com.huawei.android.push.intent.RECEIVE" />
                </intent-filter>
            </receiver>
            
            <service
                android:name="com.baidu.android.pushservice.job.PushJobService"
                android:permission="android.permission.BIND_JOB_SERVICE"
                android:process=":bdservice_v1" />
            <receiver
                android:name="com.baidu.android.pushservice.PushServiceReceiver"
                android:exported="false"
                android:process=":bdservice_v1" >
                <intent-filter>
                    <action android:name="com.baidu.android.pushservice.action.notification.SHOW" />
                    <action android:name="com.baidu.android.pushservice.action.advertise.notification.SHOW" />
                    <action android:name="com.baidu.android.pushservice.action.adnotification.ADCLICK" />
                    <action android:name="com.baidu.android.pushservice.action.adnotification.ADDELETE" />
                    <action android:name="com.baidu.android.pushservice.action.media.CLICK" />
                </intent-filter>
            </receiver>
            
            <meta-data
                android:name="com.baidu.push.cid.cesium.ver"
                android:value="270" />
        </config-file>

        <!-- Add additional components as needed -->
        <!-- Example for Huawei Proxy -->
        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <activity
                android:name="com.baidu.android.pushservice.hwproxy.HwNotifyActivity"
                android:exported="true"
                android:launchMode="singleTask"
                android:theme="@android:style/Theme.NoDisplay">
                <intent-filter>
                    <action android:name="android.intent.action.VIEW" />
                    <category android:name="android.intent.category.DEFAULT" />
                    <data
                        android:host="bdpush"
                        android:path="/hwnotify"
                        android:scheme="baidupush" />
                </intent-filter>
            </activity>
        </config-file>

        <config-file target="AndroidManifest.xml" parent="/*">
        <application>
            <!-- 华为HMS接入声明service start -->
            <!-- Uncomment the following if using HMS -->
            
            <service
                android:name="com.baidu.android.pushservice.HmsPushPatchMessageService"
                android:exported="false">
                <intent-filter>
                    <action android:name="com.huawei.push.action.MESSAGING_EVENT" />
                </intent-filter>
            </service>
           
            <!-- 华为HMS接入声明service end -->

            <!-- 荣耀 Push SDK接入声明 -->
            <service
                android:name="com.baidu.android.pushservice.honorproxy.MyHonorMsgService"
                android:exported="false">
                <intent-filter>
                    <action android:name="com.hihonor.push.action.MESSAGING_EVENT" />
                </intent-filter>
            </service>
            <activity
                android:name="com.baidu.android.pushservice.honorproxy.HonorProxyActivity"
                android:exported="true"
                android:launchMode="singleTask"
                android:theme="@android:style/Theme.NoDisplay">
                <intent-filter>
                    <action android:name="android.intent.action.VIEW" />
                    <category android:name="android.intent.category.DEFAULT" />
                    <category android:name="android.intent.category.BROWSABLE" />
                    <data android:host="bdpush" android:path="/honornotify" android:scheme="baidupush" />
                </intent-filter>
            </activity>
            <!-- 荣耀 Push SDK接入声明结束 -->

            <!-- 小米代理设置 -->
            <receiver
                android:name="com.baidu.android.pushservice.PushPatchMessageReceiver"
                android:exported="true">
                <intent-filter>
                    <action android:name="com.xiaomi.mipush.RECEIVE_MESSAGE" />
                    <action android:name="com.xiaomi.mipush.MESSAGE_ARRIVED" />
                    <action android:name="com.xiaomi.mipush.ERROR" />
                </intent-filter>
            </receiver>
            <activity
                android:name="com.baidu.android.pushservice.xmproxy.XmNotifyActivity"
                android:launchMode="singleTask"
                android:theme="@android:style/Theme.NoDisplay" />
            <!-- 小米代理设置结束 -->

            <!-- 魅族代理推送必需组件 -->
            <activity
                android:name="com.baidu.android.pushservice.mzproxy.MzNotifyActivity"
                android:launchMode="singleTask"
                android:theme="@android:style/Theme.NoDisplay" />
            <receiver
                android:name="com.baidu.android.pushservice.MzPushPatchMessageReceiver"
                android:exported="true"
                android:permission="com.meizu.cloud.push.permission.MESSAGE">
                <intent-filter>
                    <action android:name="com.meizu.flyme.push.intent.MESSAGE" />
                    <action android:name="com.meizu.flyme.push.intent.REGISTER.FEEDBACK" />
                    <action android:name="com.meizu.flyme.push.intent.UNREGISTER.FEEDBACK" />
                    <category android:name="com.cordova.plugins.push.baidu" />
                </intent-filter>
            </receiver>
            <!-- 魅族代理推送必需组件结束 -->

            <!-- OPPO推送必要配置 -->
            <service
                android:name="com.heytap.msp.push.service.DataMessageCallbackService"
                android:exported="true"
                android:permission="com.heytap.mcs.permission.SEND_PUSH_MESSAGE">
                <intent-filter>
                    <action android:name="com.heytap.mcs.action.RECEIVE_MCS_MESSAGE" />
                    <action android:name="com.heytap.msp.push.RECEIVE_MCS_MESSAGE" />
                </intent-filter>
            </service>
            <service
                android:name="com.heytap.msp.push.service.CompatibleDataMessageCallbackService"
                android:exported="true"
                android:permission="com.coloros.mcs.permission.SEND_MCS_MESSAGE">
                <intent-filter>
                    <action android:name="com.coloros.mcs.action.RECEIVE_MCS_MESSAGE" />
                </intent-filter>
            </service>
            <activity
                android:name="com.baidu.android.pushservice.opproxy.OpNotifyActivity"
                android:configChanges="orientation|keyboardHidden"
                android:exported="true"
                android:launchMode="singleInstance"
                android:theme="@android:style/Theme.NoDisplay">
                <intent-filter>
                    <action android:name="com.cordova.plugins.push.baidu.action.RECEIVE_MCS_MESSAGE" />
                    <category android:name="android.intent.category.DEFAULT" />
                </intent-filter>
            </activity>
            <!-- OPPO推送必要配置结束 -->

            <!-- VIVO代理推送 -->
            <service
                android:name="com.vivo.push.sdk.service.CommandClientService"
                android:exported="true"
                android:permission="com.push.permission.UPSTAGESERVICE" />
            <receiver
                android:name="com.baidu.android.pushservice.viproxy.ViPushMessageReceiver"
                android:exported="false">
                <intent-filter>
                    <action android:name="com.vivo.pushclient.action.RECEIVE" />
                </intent-filter>
            </receiver>
            <activity
                android:name="com.baidu.android.pushservice.viproxy.ViNotifyActivity"
                android:exported="true"
                android:launchMode="singleTask"
                android:theme="@android:style/Theme.NoDisplay">
                <intent-filter>
                    <action android:name="android.intent.action.VIEW" />
                    <category android:name="android.intent.category.DEFAULT" />
                    <data android:host="bdpush" android:path="/vinotify" android:scheme="baidupush" />
                </intent-filter>
            </activity>
            <!-- VIVO代理推送结束 -->

            <!-- Push SDK Version -->
            <meta-data
                android:name="com.baidu.push.cid.cesium.ver"
                android:value="270" />
        </application>
    </config-file>
    <source-file src="src/android/BaiduPush.java" target-dir="src/com/cordova/plugins/push/baidu" />
    <source-file src="src/android/BaiduPushReceiver.java" target-dir="src/com/cordova/plugins/push/baidu" />
    <source-file src="libs/android/arm64-v8a/libbdpush_V3_8.so" target-dir="libs/arm64-v8a" />
    <source-file src="libs/android/armeabi/libbdpush_V3_8.so" target-dir="libs/armeabi" />
    <source-file src="libs/android/armeabi-v7a/libbdpush_V3_8.so" target-dir="libs/armeabi-v7a" />
    <source-file src="libs/android/pushservice-8.3.68.0.jar" target-dir="libs" />
  </platform>

    <!-- ios -->
    <platform name="ios">
        <config-file target="config.xml" parent="/*">
            <feature name="BaiduPush">
                <param name="ios-package" value="BaiduPushPlugin"/>
            </feature>
        </config-file>

        <header-file src="src/ios/BaiduPushPlugin.h" />
        <source-file src="src/ios/BaiduPushPlugin.m" />

      <!-- Wechat Official -->
      <header-file src="libs/ios/BPush.h" />
      <source-file src="libs/ios/libBPush.a" framework="true" />

      <!-- Other required frameworks -->
      <framework src="libz.dylib" />
      <framework src="Foundation.framework" />
      <framework src="CoreTelephony.framework" />
      <framework src="SystemConfiguration.framework" />

    </platform>
</plugin>
